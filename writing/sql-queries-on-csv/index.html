<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Joel Kitching"><link rel="shortcut icon" href=https://joelkitching.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://joelkitching.com/writing/sql-queries-on-csv/><title>Running SQL queries on CSV data</title></head><body><header id=banner><h2><a href=https://joelkitching.com/>Joel Kitching</a></h2><nav><ul><li><a href=/ title>writing</a></li><li><a href=/about/ title>about</a></li><li><a href=https://github.com/jkitching title>github</a></li><li><a href=https://www.linkedin.com/in/joelkitching title>linkedin</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Running SQL queries on CSV data</h1><div><time>March 16, 2024</time></div></header><p>I was recently working with some CSV files pulled from a Samsung Health dump. I wanted to run a few queries on the data in order to familiarize myself with their format and contents. SQL seemed like a natural choice, and it turns out there is a myriad of different ways to directly query CSV data with SQL.</p><p>A few notes:</p><ul><li>The first two lines of the file is extraneous information that Samsung Health includes for its own purposes. Hence the <code>tail -n +2</code> command.</li><li>It turns out that there is one more header value than in the data rows themselves. Some of these tools are not particularly happy about this, and so the <code>sed</code> command removes the very last (empty) header value.</li></ul><h1 id=q>q</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tail -n +2 device_profiles.csv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> q -d, -H -b -O -T <span class=s1>&#39;select * from -&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> less -S
</span></span></code></pre></div><h1 id=trdsql>trdsql</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tail -n +2 device_profiles.csv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> trdsql -ih -icsv -oat <span class=s1>&#39;select * from -&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> less -S
</span></span></code></pre></div><h1 id=sqlite3>sqlite3</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tail -n +2 device_profiles.csv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> sqlite3 -csv :memory: <span class=s1>&#39;.import /dev/stdin stdin&#39;</span> <span class=s1>&#39;.mode table&#39;</span> <span class=s1>&#39;select * from stdin&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> less -S
</span></span></code></pre></div><h1 id=duckdb>duckdb</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tail -n +2 device_profiles.csv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> sed <span class=s1>&#39;s@,$@@&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> duckdb -table -cmd <span class=s1>&#39;create table stdin as select * from read_csv_auto(&#34;/dev/stdin&#34;); select * from stdin;&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> less -S
</span></span></code></pre></div><h1 id=csvlook>csvlook</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tail -n +2 device_profiles.csv <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> sed <span class=s1>&#39;s@,$@@&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> csvsql --query <span class=s1>&#39;select * from stdin&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> csvlook <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> less -S
</span></span></code></pre></div></article></main><footer id=footer>Copyright © 2022–2024 Joel Isaac Stewart Davies-Kitching</footer></body></html>