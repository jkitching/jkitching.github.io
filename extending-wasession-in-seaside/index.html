<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Joel Kitching"><link rel="shortcut icon" href=https://joelkitching.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://joelkitching.com/extending-wasession-in-seaside/><title>Extending WASession in Seaside</title></head><body><header id=banner><h2><a href=https://joelkitching.com/>Joel Kitching</a></h2><nav><ul><li><a href=/ title>posts</a></li><li><a href=/about/ title>about</a></li><li><a href=https://twitter.com/joelkitching title>twitter</a></li><li><a href=https://github.com/jkitching title>github</a></li><li><a href=https://www.linkedin.com/in/joelkitching title>linkedin</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Extending WASession in Seaside</h1><div><time>June 23, 2009</time></div></header><p>One of the goals I had with this blog was to make the maintenance and updates dead simple. Certainly, I could open up the Squeak image every time I want to add a post, but I wanted to be able to edit and create posts directly in the browser.</p><h1 id=what-is-wasession>What is WASession?</h1><p>A WASession instance is created when &ldquo;a user accesses an application for the first time and is persistent as long as the user is interacting with it.&rdquo; You who is reading this post have an instance of WASession stored in the Squeak image behind this website right now!</p><p>The beauty of this system is that you can store information about <em>who</em> is viewing the blog in the WASession instance, by subclassing it. I extended WASession, and simply added an instance variable called <code>admin</code>, along with appropriate setter and accessor methods:</p><ul><li><strong><code>WASession</code></strong><ul><li><strong><code>JKSession</code></strong> extends <strong><code>WASession</code></strong><ul><li>instance variables:<ul><li><code>admin</code></li></ul></li><li>methods:<ul><li><code>isAdmin</code></li><li><code>setAdmin</code></li><li><code>unsetAdmin</code></li><li><code>initialize</code> (runs <code>self unsetAdmin</code>)</li></ul></li></ul></li></ul></li></ul><h1 id=logging-in-as-an-administrator>Logging in as an administrator</h1><p>I wanted to be able to do what most people would expect on modern CMS&rsquo;s today: go to a private <code>/admin</code> URL and log in to receive special privileges. Try it, and see what happens! (I won&rsquo;t put a link so that the ubiquitous Google spider will not find it.)</p><p>On the Seaside of things, this involved extending my main <strong>JKLayout</strong> application class, pointing <code>/admin</code> to that class with password protection, and then in the initialization method, calling the session&rsquo;s <code>setAdmin</code> method.</p><ul><li><strong><code>JKLayout</code></strong><ul><li><strong><code>JKAdminLayout</code></strong> extends <strong><code>JKLayout</code></strong><ul><li>methods:<ul><li><code>initialize</code> (runs <code>self session setAdmin</code>)</li></ul></li></ul></li></ul></li></ul><p>To install both of these applications at their respective locations, I ran these commands in a workspace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-squeak data-lang=squeak><span class=line><span class=cl><span class=c>&#34;registers the application for normal users&#34;</span>
</span></span><span class=line><span class=cl><span class=nc>JKLayout</span> <span class=nf>registerAsApplication:</span> <span class=nv>index</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&#34;registers the application for administrators&#34;</span>
</span></span><span class=line><span class=cl><span class=c>&#34;note: prompts you for a username and password&#34;</span>
</span></span><span class=line><span class=cl><span class=nf>JKAdminLayout</span> <span class=nf>registerAsAuthenticatedApplication:</span> <span class=nv>admin</span>
</span></span></code></pre></div><h1 id=administrator-privileges>Administrator privileges</h1><p>Now, whenever I want to have hidden content or extra links that only an administrator can see, it is as simple as: <code>self session isAdmin ifTrue: [ ... ]</code>, which can be called within any WAComponent instance.</p><p>On my own blog, this allowed me to add links to create, edit and delete posts, also creating the appropriate forms to which these links point. In addition, I show all unpublished content and mark it as such, allowing me to gradually write draft posts.</p><h1 id=different-user-different-content>Different user, different content</h1><p>Similar techniques can be used for sites that have multiple levels of accounts. For example, you might have an e-commerce website in which the administrator needs to be able to add and edit items for sale, with user accounts with the ability to purchase said items.</p><p>Now go forth and code your subclassed WASessions!</p></article></main><footer id=footer>Copyright Â© 2022 Joel Isaac Stewart Davies-Kitching</footer></body></html>